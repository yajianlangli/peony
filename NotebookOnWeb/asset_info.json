{"name": "notebookOnWeb", "xml": "import sys\nfrom xes.tool import xopen\nxopen()\nif '' not in sys.path:\n    sys.path.append(\".\")\n\nfrom notebookOnWeb import app\nfrom os import environ\nport = int(environ.get('PORT',80))\napp.run(host='0.0.0.0',port=port,debug=True)\n", "type": "run", "lang": "python", "id": 18564640, "original_id": 6, "version": "offline", "args": [], "planid": null, "problemid": null, "projectid": 18564640, "removed": 0, "user_id": 13221519, "code_complete": 1, "assets": [{"id": "95c70b1e-0a4d-5312-ad20-e567bb402c7e", "isSelected": false, "level": 2, "isLeaf": false, "isDir": true, "name": "notebookOnWeb", "percentage": 0, "loading": false, "fileStatus": "normal", "size": 0, "value": "", "text": "notebookOnWeb", "title": "notebookOnWeb", "disabled": false, "isExpanded": true, "icon": "iconfont iconfold", "type": "dir", "sort": 1, "pid": 0, "preClick": false, "children": [{"id": "c234f924-decb-6492-bc4e-ebc8433c204d", "isSelected": false, "level": 3, "isLeaf": false, "isDir": true, "name": "static", "percentage": 0, "loading": false, "fileStatus": "normal", "size": 0, "value": "", "text": "static", "title": "static", "disabled": false, "isExpanded": true, "icon": "iconfont iconfold", "type": "dir", "sort": 1, "hide": false, "pid": "95c70b1e-0a4d-5312-ad20-e567bb402c7e", "children": [{"id": "5af52e3f-0fcf-c537-bd55-879abcf2c1d2", "isSelected": false, "level": 4, "isLeaf": false, "isDir": true, "name": "scripts", "percentage": 0, "loading": false, "fileStatus": "normal", "size": 0, "value": "", "text": "scripts", "title": "scripts", "disabled": false, "isExpanded": true, "icon": "iconfont iconfold", "type": "dir", "sort": 1, "hide": false, "pid": "c234f924-decb-6492-bc4e-ebc8433c204d", "children": [{"id": "e10be8ad-dacb-dcea-5e6a-f21566a37815", "isSelected": false, "level": 5, "isLeaf": true, "isDir": false, "name": "qrcode.js", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 33168, "value": "", "text": "qrcode.js", "title": "qrcode.js", "disabled": false, "isExpanded": true, "dataFormat": "js", "ext": "js", "icon": "iconfont iconjavascript", "svgId": "#iconjavascript", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": true, "hide": false, "preview": true, "editable": true, "lang": "javascript", "color": "#449DED", "pid": "5af52e3f-0fcf-c537-bd55-879abcf2c1d2", "operation": "uploadOk", "state": "uploadOk", "md5ext": "663ef62276512200b83bd4076a4a039d.js", "assetId": "663ef62276512200b83bd4076a4a039d", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\static\\scripts"}]}]}, {"id": "ef29ebea-966b-e27a-972e-98c3615f49cd", "isSelected": false, "level": 3, "isLeaf": false, "isDir": true, "name": "templates", "percentage": 0, "loading": false, "fileStatus": "normal", "size": 0, "value": "", "text": "templates", "title": "templates", "disabled": false, "isExpanded": false, "icon": "iconfont iconfold", "type": "dir", "sort": 1, "hide": false, "pid": "95c70b1e-0a4d-5312-ad20-e567bb402c7e", "children": [{"id": "e66716db-38cc-edc2-3b88-ae8f9040bd45", "isSelected": false, "level": 4, "isLeaf": true, "isDir": false, "name": "editnotes.html", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 868, "value": "", "text": "editnotes.html", "title": "editnotes.html", "disabled": false, "isExpanded": false, "dataFormat": "html", "ext": "html", "icon": "iconfont iconhtml", "svgId": "#iconhtml", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": true, "hide": false, "assetId": "9eb2440ff5010185a6f38d2006e23259", "md5ext": "9eb2440ff5010185a6f38d2006e23259.html", "preClick": false, "mode": "client", "state": "uploadOk", "operation": "uploadOk", "preview": true, "editable": true, "lang": "html", "color": "#FC490B", "pid": "ef29ebea-966b-e27a-972e-98c3615f49cd", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\templates"}, {"id": "b212f6d2-8426-61b5-6c05-03448953c5a7", "isSelected": false, "level": 4, "isLeaf": true, "isDir": false, "name": "users.html", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 346, "value": "", "text": "index.html", "title": "index.html", "disabled": false, "isExpanded": false, "dataFormat": "html", "ext": "html", "icon": "iconfont iconhtml", "svgId": "#iconhtml", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": true, "hide": false, "assetId": "46eb5ec444515e2bd10f1b8bb06e1000", "md5ext": "46eb5ec444515e2bd10f1b8bb06e1000.html", "preClick": false, "mode": "client", "state": "uploadOk", "operation": "uploadOk", "preview": true, "editable": true, "lang": "html", "color": "#FC490B", "pid": "ef29ebea-966b-e27a-972e-98c3615f49cd", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\templates"}, {"id": "2314aff9-6c2e-1e1b-80a9-ea1e72113078", "isSelected": false, "level": 4, "isLeaf": true, "isDir": false, "name": "notes.html", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 206, "value": "", "text": "index.html", "title": "index.html", "disabled": false, "isExpanded": true, "dataFormat": "html", "ext": "html", "icon": "iconfont iconhtml", "svgId": "#iconhtml", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": true, "hide": false, "preview": true, "editable": true, "lang": "html", "color": "#FC490B", "pid": "ef29ebea-966b-e27a-972e-98c3615f49cd", "operation": "uploadOk", "state": "uploadOk", "md5ext": "1121766e39c7cc03a3abe32b77764394.html", "assetId": "1121766e39c7cc03a3abe32b77764394", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\templates"}, {"id": "0ff53f27-a6da-6d6f-add9-68d60b76c5db", "isSelected": false, "level": 4, "isLeaf": true, "isDir": false, "name": "logon.html", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 894, "value": "", "text": "logon.html", "title": "logon.html", "disabled": false, "isExpanded": true, "dataFormat": "html", "ext": "html", "icon": "iconfont iconhtml", "svgId": "#iconhtml", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": true, "hide": false, "preview": true, "editable": true, "lang": "html", "color": "#FC490B", "pid": "ef29ebea-966b-e27a-972e-98c3615f49cd", "operation": "uploadOk", "state": "uploadOk", "md5ext": "ee1148577ed26ef05dc180d12eb92bec.html", "assetId": "ee1148577ed26ef05dc180d12eb92bec", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\templates"}, {"id": "4def718d-78a2-8ee2-a419-e8d00d0ea46f", "isSelected": false, "level": 4, "isLeaf": true, "isDir": false, "name": "base.html", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 2636, "value": "", "text": "base.html", "title": "base.html", "disabled": false, "isExpanded": true, "dataFormat": "html", "ext": "html", "icon": "iconfont iconhtml", "svgId": "#iconhtml", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": true, "hide": false, "preview": true, "editable": true, "lang": "html", "color": "#FC490B", "pid": "ef29ebea-966b-e27a-972e-98c3615f49cd", "operation": "uploadOk", "state": "uploadOk", "md5ext": "39bb9c2ac6dbb1ec1d9af60c3c0ce89a.html", "assetId": "39bb9c2ac6dbb1ec1d9af60c3c0ce89a", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\templates"}, {"id": "c01fda91-a4e4-aa47-e66c-41d38d1088b7", "isSelected": false, "level": 4, "isLeaf": true, "isDir": false, "name": "login.html", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 639, "value": "", "text": "login.html", "title": "login.html", "disabled": false, "isExpanded": true, "dataFormat": "html", "ext": "html", "icon": "iconfont iconhtml", "svgId": "#iconhtml", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": true, "hide": false, "preview": true, "editable": true, "lang": "html", "color": "#FC490B", "pid": "ef29ebea-966b-e27a-972e-98c3615f49cd", "operation": "uploadOk", "state": "uploadOk", "md5ext": "a4a6a3e6fdee71f69d6069ddbf99c7f2.html", "assetId": "a4a6a3e6fdee71f69d6069ddbf99c7f2", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\templates"}, {"id": "f6983fca-6330-015d-4e99-03f51a591b3a", "isSelected": false, "level": 4, "isLeaf": true, "isDir": false, "name": "shownotes.html", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 408, "value": "", "text": "shownotes.html", "title": "shownotes.html", "disabled": false, "isExpanded": true, "dataFormat": "html", "ext": "html", "icon": "iconfont iconhtml", "svgId": "#iconhtml", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": true, "hide": false, "preview": true, "editable": true, "lang": "html", "color": "#FC490B", "pid": "ef29ebea-966b-e27a-972e-98c3615f49cd", "operation": "uploadOk", "state": "uploadOk", "md5ext": "1953e050e545c924b09ca35b41294222.html", "assetId": "1953e050e545c924b09ca35b41294222", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\templates"}, {"id": "5021b042-e2f9-4c5e-fa72-2f1942019f43", "isSelected": false, "level": 4, "isLeaf": true, "isDir": false, "name": "index.html", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 80, "value": "", "text": "index.html", "title": "index.html", "disabled": false, "isExpanded": true, "dataFormat": "html", "ext": "html", "icon": "iconfont iconhtml", "svgId": "#iconhtml", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": true, "hide": false, "preview": true, "editable": true, "lang": "html", "color": "#FC490B", "pid": "ef29ebea-966b-e27a-972e-98c3615f49cd", "operation": "uploadOk", "state": "uploadOk", "md5ext": "ddab085ce8858baa0a5f9bc36d6e603a.html", "assetId": "ddab085ce8858baa0a5f9bc36d6e603a", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\templates"}]}, {"id": "a08b294f-46c5-6c8f-6e4d-387e2c762c4d", "isSelected": false, "level": 3, "isLeaf": false, "isDir": true, "name": "__pycache__", "percentage": 0, "loading": false, "fileStatus": "normal", "size": 0, "value": "", "text": "__pycache__", "title": "__pycache__", "disabled": false, "isExpanded": false, "icon": "iconfont iconfold", "type": "dir", "sort": 1, "hide": false, "pid": "95c70b1e-0a4d-5312-ad20-e567bb402c7e", "children": [{"id": "e1996624-a336-1fbc-67d9-0662bf226217", "isSelected": false, "level": 4, "isLeaf": true, "isDir": false, "name": "forms.cpython-37.pyc", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 2188, "value": "", "text": "forms.cpython-37.pyc", "title": "forms.cpython-37.pyc", "disabled": false, "isExpanded": false, "dataFormat": "pyc", "ext": "pyc", "icon": "iconfont iconother", "svgId": "#iconother", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": false, "hide": false, "assetId": "89d1cca837441a9f0a019cc8d01aa8a9", "md5ext": "89d1cca837441a9f0a019cc8d01aa8a9.pyc", "preClick": false, "mode": "client", "state": "uploadOk", "operation": "uploadOk", "pid": "a08b294f-46c5-6c8f-6e4d-387e2c762c4d", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\__pycache__"}, {"id": "698d0e73-a624-e33c-2bb8-ce4da5bfa9b5", "isSelected": false, "level": 4, "isLeaf": true, "isDir": false, "name": "config.cpython-37.pyc", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 423, "value": "", "text": "config.cpython-37.pyc", "title": "config.cpython-37.pyc", "disabled": false, "isExpanded": false, "dataFormat": "pyc", "ext": "pyc", "icon": "iconfont iconother", "svgId": "#iconother", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": false, "hide": false, "assetId": "f99ea5345932b1bc5ca860ff4905baa8", "md5ext": "f99ea5345932b1bc5ca860ff4905baa8.pyc", "preClick": false, "mode": "client", "state": "uploadOk", "operation": "uploadOk", "pid": "a08b294f-46c5-6c8f-6e4d-387e2c762c4d", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\__pycache__"}, {"id": "3c90234c-3dee-3c36-c5d7-b0880a53d878", "isSelected": false, "level": 4, "isLeaf": true, "isDir": false, "name": "views.cpython-37.pyc", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 4756, "value": "", "text": "views.cpython-37.pyc", "title": "views.cpython-37.pyc", "disabled": false, "isExpanded": false, "dataFormat": "pyc", "ext": "pyc", "icon": "iconfont iconother", "svgId": "#iconother", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": false, "hide": false, "assetId": "141ecf40b3d46caa0954dcff42aa8d24", "md5ext": "141ecf40b3d46caa0954dcff42aa8d24.pyc", "preClick": false, "mode": "client", "state": "uploadOk", "operation": "uploadOk", "pid": "a08b294f-46c5-6c8f-6e4d-387e2c762c4d", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\__pycache__"}, {"id": "74e6c668-5e72-ae9c-a659-bc372e5707bd", "isSelected": false, "level": 4, "isLeaf": true, "isDir": false, "name": "__init__.cpython-37.pyc", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 411, "value": "", "text": "__init__.cpython-37.pyc", "title": "__init__.cpython-37.pyc", "disabled": false, "isExpanded": false, "dataFormat": "pyc", "ext": "pyc", "icon": "iconfont iconother", "svgId": "#iconother", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": false, "hide": false, "assetId": "0c6234364ac1d2a49514277f59676692", "md5ext": "0c6234364ac1d2a49514277f59676692.pyc", "preClick": false, "mode": "client", "state": "uploadOk", "operation": "uploadOk", "pid": "a08b294f-46c5-6c8f-6e4d-387e2c762c4d", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb\\__pycache__"}]}, {"id": "e9cd73a8-5427-7d7b-57cc-f1e470a86af4", "isSelected": false, "level": 3, "isLeaf": true, "isDir": false, "name": "config.py", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 171, "value": "", "text": "config.py", "title": "config.py", "disabled": false, "isExpanded": false, "dataFormat": "py", "ext": "py", "icon": "iconfont iconpython", "svgId": "#iconpython", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": false, "hide": false, "assetId": "e9fc6a8fc76bce2897e7f49a08587374", "md5ext": "e9fc6a8fc76bce2897e7f49a08587374.py", "preClick": false, "mode": "client", "state": "uploadOk", "operation": "uploadOk", "preview": true, "editable": true, "lang": "python", "color": "#FFA629", "pid": "95c70b1e-0a4d-5312-ad20-e567bb402c7e", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb"}, {"id": "c6fff96f-7641-81f0-196b-167604b053b0", "isSelected": false, "level": 3, "isLeaf": true, "isDir": false, "name": "forms.py", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 2187, "value": "", "text": "forms.py", "title": "forms.py", "disabled": false, "isExpanded": false, "dataFormat": "py", "ext": "py", "icon": "iconfont iconpython", "svgId": "#iconpython", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": true, "hide": false, "assetId": "c1fb9825678a29c0625d58b67b24c59b", "md5ext": "c1fb9825678a29c0625d58b67b24c59b.py", "preClick": false, "mode": "client", "state": "uploadOk", "operation": "uploadOk", "preview": true, "editable": true, "lang": "python", "color": "#FFA629", "pid": "95c70b1e-0a4d-5312-ad20-e567bb402c7e", "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640\\notebookOnWeb"}, {"id": "7a076c45-0299-1dcb-6cc9-eef6a534cc67", "isSelected": false, "level": 3, "isLeaf": true, "isDir": false, "name": "views.py", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 5643, "value": "from flask import \\\n    render_template,\\\n    redirect,\\\n    url_for,\\\n    session\nimport sqlite3\nfrom notebookOnWeb.forms import *\nfrom notebookOnWeb import app\nimport hashlib\nimport socket\ns = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\ns.connect(('8.8.8.8', 80))\nip = s.getsockname()[0]\ns.close()\n\nconn = sqlite3.connect(\"data.db\",check_same_thread=False)\ncursor = conn.cursor()\n\ntry:\n    cursor.execute(\n        \"\"\"\n        CREATE TABLE users(\n            name        CHAR(10) PRIMARY KEY    NOT NULL,\n            pswdhash    CHAR(40)                NOT NULL\u5427ggggggt\n        );\n        \"\"\"\n    )\n    conn.commit()\nexcept Exception as e:print(e)\n\ntry:\n    cursor.execute(\n        \"\"\"\n        CREATE TABLE notes(\n            topic    CHAR(20)    NOT NULL,\n            name     CHAR(10)    NOT NULL,\n            note     CHAR(20000) NOT NULL,\n            notehash CHAR(40)    NOT NULL,\n            public   INTEGER     NOT NULL,\n            stars    INT         NOT NULL\n        );\n        \"\"\"\n    )\n    conn.commit()\nexcept Exception as e:print(e)\n\n@app.route('/notes')\ndef notes():\n    global ip\n    cursor.execute(\"SELECT topic FROM notes WHERE name=? OR public=1\",(session.get('usr'),))\n    topics = list(set(cursor.fetchall()))\n    return render_template(\n        'notes.html',\n        usr=session.get('usr'),\n        topics=topics,\n        ip=ip\n    )\n\n@app.route('/users')\ndef users():\n    global ip\n    cursor.execute(\"SELECT topic,name FROM notes WHERE name=? OR public=1\",(session.get('usr'),))\n    topics = list(set(cursor.fetchall()))\n    cursor.execute(\"SELECT name FROM users\")\n    users = list(set(cursor.fetchall()))\n    return render_template(\n        'users.html',\n        usr=session.get('usr'),\n        topics=topics,\n        users=users,\n        ip=ip\n    )\n\n@app.route('/')\ndef toHome(): # go back home\n    return render_template('index.html',\n                          title='\u6b22\u8fce\u6765\u5230',\n                          usr=session.get('usr'),\n                          ip=ip)\n\n@app.route('/login',methods=['GET','POST'])\ndef login():\n    global ip\n    loginform = loginForm()\n    if loginform.validate_on_submit():\n        cursor.execute(\"SELECT pswdhash FROM users WHERE name = ?\",(loginform.username.data,))\n        res = cursor.fetchone() or [None]\n        if res[0] == hashlib.md5(bytes(loginform.userpass.data,encoding='utf-8')).hexdigest():\n            session['usr'] = loginform.username.data\n            return redirect(\"/\")\n        else:\n            return render_template('login.html',\n                                  title='\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u767b\u9646',\n                                  form=loginform,\n                                  usr=session.get('usr'),\n                                  ip=ip)\n    return render_template('login.html',\n                          title='\u767b\u5f55',\n                          form=loginform,\n                          usr=session.get('usr'),\n                          ip=ip)\n\n@app.route('/edit',methods=['GET','POST'])\ndef edit():\n    global ip\n    editform = editForm()\n    if not session.get('usr'):\n        return redirect(url_for(\"login\"))\n    if editform.validate_on_submit():\n        cursor.execute(\"INSERT INTO notes VALUES (?,?,?,?,?)\",(\n            editform.topic.data,\n            session['usr'],\n            editform.note.data,\n            hashlib.md5(bytes(editform.note.data,encoding='utf-8')).hexdigest(),\n            editform.public.data,\n            0,))\n        conn.commit()\n        return redirect(url_for(\"notes\"))\n    return render_template('editnotes.html',\n                          title='\u5199\u4e0b\u4f60\u7684\u60f3\u6cd5',\n                          form=editform,\n                          usr=session.get('usr'),\n                          ip=ip)\n\n@app.route('/del/<hash_>',methods=['GET','POST'])\ndef delete(hash_):\n    cursor.execute(\"DELETE FROM notes WHERE notehash = ?\",(hash_,))\n    conn.commit()\n    return redirect(\"/\")\n\n@app.route('/logon',methods=['GET','POST'])\ndef logon():\n    global ip\n    logonform = logonForm()\n    if logonform.validate_on_submit():\n        cursor.execute(\"SELECT pswdhash FROM users WHERE name = ?\",\n                          (logonform.username.data,))\n        if cursor.fetchone():\n            return render_template('logon.html',\n                                  title='\u7528\u6237\u540d\u5df2\u5b58\u5728',\n                                  form=logonform,\n                                  usr=session.get('usr'),\n                                  ip=ip)\n        cursor.execute(\"INSERT INTO users VALUES (?,?)\",(\n            logonform.username.data,\n            hashlib.md5(bytes(logonform.userpass.data,encoding='utf-8')).hexdigest()))\n        conn.commit()\n        session['usr'] = logonform.username.data\n        return redirect(\"/\")\n    return render_template('logon.html',\n                          title='\u6ce8\u518c',\n                          form=logonform,\n                          usr=session.get('usr'),\n                          ip=ip)\n\n@app.route('/logout',methods=['GET','POST'])\ndef logout():\n    session.pop('usr',None)\n    return redirect(\"/\")\n\n@app.route('/shownotes/<topic>')\ndef shownotes(topic):\n    global ip\n    cursor.execute(\"SELECT name,note FROM notes WHERE topic=? AND (name=? OR public=1)\",\n                  (topic,session.get('usr')))\n    notes = cursor.fetchall()\n    return render_template('shownotes.html',\n                          title='\u4e3b\u9898\u4e3a{}\u7684\u77e5\u8bc6\u672c'.format(topic),\n                          notes=notes,\n                          usr=session.get('usr'),\n                          hashlib=hashlib,\n                          bytes=bytes,\n                          ip=ip)\n", "text": "views.py", "title": "views.py", "disabled": false, "isExpanded": true, "dataFormat": "py", "ext": "py", "icon": "iconfont iconpython", "svgId": "#iconpython", "type": "local_file", "originValue": "from flask import \\\n    render_template,\\\n    redirect,\\\n    url_for,\\\n    session\nimport sqlite3\nfrom notebookOnWeb.forms import *\nfrom notebookOnWeb import app\nimport hashlib\nimport socket\ns = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\ns.connect(('8.8.8.8', 80))\nip = s.getsockname()[0]\ns.close()\n\nconn = sqlite3.connect(\"data.db\",check_same_thread=False)\ncursor = conn.cursor()\n\ntry:\n    cursor.execute(\n        \"\"\"\n        CREATE TABLE users(\n            name        CHAR(10) PRIMARY KEY    NOT NULL,\n            pswdhash    CHAR(40)                NOT NULL\u5427ggggggt\n        );\n        \"\"\"\n    )\n    conn.commit()\nexcept Exception as e:print(e)\n\ntry:\n    cursor.execute(\n        \"\"\"\n        CREATE TABLE notes(\n            topic    CHAR(20)    NOT NULL,\n            name     CHAR(10)    NOT NULL,\n            note     CHAR(20000) NOT NULL,\n            notehash CHAR(40)    NOT NULL,\n            public   INTEGER     NOT NULL,\n            stars    INT         NOT NULL\n        );\n        \"\"\"\n    )\n    conn.commit()\nexcept Exception as e:print(e)\n\n@app.route('/notes')\ndef notes():\n    global ip\n    cursor.execute(\"SELECT topic FROM notes WHERE name=? OR public=1\",(session.get('usr'),))\n    topics = list(set(cursor.fetchall()))\n    return render_template(\n        'notes.html',\n        usr=session.get('usr'),\n        topics=topics,\n        ip=ip\n    )\n\n@app.route('/users')\ndef users():\n    global ip\n    cursor.execute(\"SELECT topic,name FROM notes WHERE name=? OR public=1\",(session.get('usr'),))\n    topics = list(set(cursor.fetchall()))\n    cursor.execute(\"SELECT name FROM users\")\n    users = list(set(cursor.fetchall()))\n    return render_template(\n        'users.html',\n        usr=session.get('usr'),\n        topics=topics,\n        users=users,\n        ip=ip\n    )\n\n@app.route('/')\ndef toHome(): # go back home\n    return render_template('index.html',\n                          title='\u6b22\u8fce\u6765\u5230',\n                          usr=session.get('usr'),\n                          ip=ip)\n\n@app.route('/login',methods=['GET','POST'])\ndef login():\n    global ip\n    loginform = loginForm()\n    if loginform.validate_on_submit():\n        cursor.execute(\"SELECT pswdhash FROM users WHERE name = ?\",(loginform.username.data,))\n        res = cursor.fetchone() or [None]\n        if res[0] == hashlib.md5(bytes(loginform.userpass.data,encoding='utf-8')).hexdigest():\n            session['usr'] = loginform.username.data\n            return redirect(\"/\")\n        else:\n            return render_template('login.html',\n                                  title='\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u767b\u9646',\n                                  form=loginform,\n                                  usr=session.get('usr'),\n                                  ip=ip)\n    return render_template('login.html',\n                          title='\u767b\u5f55',\n                          form=loginform,\n                          usr=session.get('usr'),\n                          ip=ip)\n\n@app.route('/edit',methods=['GET','POST'])\ndef edit():\n    global ip\n    editform = editForm()\n    if not session.get('usr'):\n        return redirect(url_for(\"login\"))\n    if editform.validate_on_submit():\n        cursor.execute(\"INSERT INTO notes VALUES (?,?,?,?,?)\",(\n            editform.topic.data,\n            session['usr'],\n            editform.note.data,\n            hashlib.md5(bytes(editform.note.data,encoding='utf-8')).hexdigest(),\n            editform.public.data,\n            0,))\n        conn.commit()\n        return redirect(url_for(\"notes\"))\n    return render_template('editnotes.html',\n                          title='\u5199\u4e0b\u4f60\u7684\u60f3\u6cd5',\n                          form=editform,\n                          usr=session.get('usr'),\n                          ip=ip)\n\n@app.route('/del/<hash_>',methods=['GET','POST'])\ndef delete(hash_):\n    cursor.execute(\"DELETE FROM notes WHERE notehash = ?\",(hash_,))\n    conn.commit()\n    return redirect(\"/\")\n\n@app.route('/logon',methods=['GET','POST'])\ndef logon():\n    global ip\n    logonform = logonForm()\n    if logonform.validate_on_submit():\n        cursor.execute(\"SELECT pswdhash FROM users WHERE name = ?\",\n                          (logonform.username.data,))\n        if cursor.fetchone():\n            return render_template('logon.html',\n                                  title='\u7528\u6237\u540d\u5df2\u5b58\u5728',\n                                  form=logonform,\n                                  usr=session.get('usr'),\n                                  ip=ip)\n        cursor.execute(\"INSERT INTO users VALUES (?,?)\",(\n            logonform.username.data,\n            hashlib.md5(bytes(logonform.userpass.data,encoding='utf-8')).hexdigest()))\n        conn.commit()\n        session['usr'] = logonform.username.data\n        return redirect(\"/\")\n    return render_template('logon.html',\n                          title='\u6ce8\u518c',\n                          form=logonform,\n                          usr=session.get('usr'),\n                          ip=ip)\n\n@app.route('/logout',methods=['GET','POST'])\ndef logout():\n    session.pop('usr',None)\n    return redirect(\"/\")\n\n@app.route('/shownotes/<topic>')\ndef shownotes(topic):\n    global ip\n    cursor.execute(\"SELECT name,note FROM notes WHERE topic=? AND (name=? OR public=1)\",\n                  (topic,session.get('usr')))\n    notes = cursor.fetchall()\n    return render_template('shownotes.html',\n                          title='\u4e3b\u9898\u4e3a{}\u7684\u77e5\u8bc6\u672c'.format(topic),\n                          notes=notes,\n                          usr=session.get('usr'),\n                          hashlib=hashlib,\n                          bytes=bytes,\n                          ip=ip)\n", "isChange": true, "isActived": false, "sort": 0, "isOpen": true, "hide": false, "preview": true, "editable": true, "lang": "python", "color": "#FFA629", "pid": "95c70b1e-0a4d-5312-ad20-e567bb402c7e", "operation": "uploadOk", "state": "uploadOk", "md5ext": "48bd2da9468aa321c28a6eb38775b368.py", "assetId": "48bd2da9468aa321c28a6eb38775b368"}, {"id": "8259b73c-5c45-2132-072e-0dcaf5d56a0d", "isSelected": false, "level": 3, "isLeaf": true, "isDir": false, "name": "__init__.py", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 186, "value": "\"\"\"\nThe flask application package.\n\"\"\"\n\nfrom flask import Flask\nfrom notebookOnWeb.config import Config\n\napp = Flask(__name__)\napp.config.from_object(Config)\n\nimport notebookOnWeb.views\n", "text": "__init__.py", "title": "__init__.py", "disabled": false, "isExpanded": true, "dataFormat": "py", "ext": "py", "icon": "iconfont iconpython", "svgId": "#iconpython", "type": "local_file", "originValue": "\"\"\"\nThe flask application package.\n\"\"\"\n\nfrom flask import Flask\nfrom notebookOnWeb.config import Config\n\napp = Flask(__name__)\napp.config.from_object(Config)\n\nimport notebookOnWeb.views\n", "isChange": true, "isActived": false, "sort": 0, "isOpen": true, "hide": false, "preview": true, "editable": true, "lang": "python", "color": "#FFA629", "pid": "95c70b1e-0a4d-5312-ad20-e567bb402c7e", "operation": "uploadOk", "state": "uploadOk", "md5ext": "d3024a4d23ce65aa7c22549a4b997046.py", "assetId": "d3024a4d23ce65aa7c22549a4b997046"}]}, {"id": "f8852c1c-ee13-e929-113a-f27c978d8d3a", "isSelected": false, "level": 2, "isLeaf": true, "isDir": false, "name": "data.db", "percentage": 100, "loading": false, "fileStatus": "normal", "size": 40960, "value": "", "text": "data.db", "title": "data.db", "disabled": false, "isExpanded": false, "dataFormat": "db", "ext": "db", "icon": "iconfont iconother", "svgId": "#iconother", "type": "oss_file", "originValue": "", "isChange": false, "isActived": false, "sort": 0, "isOpen": false, "assetId": "382fbe199dd141a7dfe14cec7a7016d0", "md5ext": "382fbe199dd141a7dfe14cec7a7016d0.db", "preClick": false, "mode": "client", "state": "uploadOk", "operation": "uploadOk", "pid": 0, "path": "C:\\Users\\ZTJ\\\u5b66\u800c\u601d\u76f4\u64ad\\code\\cache\\asset\\18564640"}], "projectId": 18564640, "stuId": 13221519}